<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebP Converter Studio</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="shortcut icon" href="{{ url_for('static', filename='sejutajasa-favicon.svg') }}">
</head>

<body>

    <div class="layout-wrapper">
        
        <div class="nav-container">
            <nav class="breadcrumbs">
                <a href="https://sejutajasa.com">Home</a>
                <span>/</span>
                <div class="current">Image to WebP</div>
            </nav>
        </div>

        <main class="app-card">
            
            <div class="card-header">
                <h1>WebP Studio</h1>
                
                <a href="https://sejutajasa.com" class="close-btn" aria-label="Close Tool">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </a>
            </div>

            <p class="subtitle">Professional bulk image compression tool.</p>

            <form action="/" method="post" enctype="multipart/form-data">
            <div class="drop-zone" id="dropZone">
                <div class="icon-circle">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="17 8 12 3 7 8"/>
                        <line x1="12" y1="3" x2="12" y2="15"/>
                    </svg>
                </div>
                 <span class="drop-text">Drag and drop files, or <b>click to browse</b>. <br>Supported formats: JPG, JPEG, PNG.</span>
                <input type="file" name="images" id="fileInput" multiple accept=".jpg,.jpeg,.png" required>
            </div>
            
            <div class="file-status {% if error %}active error{% endif %}" id="fileInfo">
                {{ error if error else '' }}
            </div>
            
            <button type="submit" class="btn-primary">Convert Files</button>
        </form>
    </main>

    <script>
        const fileInput = document.getElementById('fileInput');
        const fileInfo = document.getElementById('fileInfo');
        const dropZone = document.getElementById('dropZone');
        const submitBtn = document.querySelector('button[type="submit"]');

        // Drag Visuals
        ['dragenter', 'dragover'].forEach(e => dropZone.addEventListener(e, ev => {
            ev.preventDefault();
            dropZone.classList.add('dragover');
        }));

        ['dragleave', 'drop'].forEach(e => dropZone.addEventListener(e, ev => {
            ev.preventDefault();
            dropZone.classList.remove('dragover');
        }));

        // Reset Function
        window.clearFiles = function() {
            fileInput.value = ''; // Clear actual input
            fileInfo.className = 'file-status'; // Hide container
            fileInfo.innerHTML = ''; // Clear text
            submitBtn.disabled = false; // Optional: Reset button state
            
            // If you want to disable submit when empty:
            // submitBtn.disabled = true; 
        };

        // Validator
        const handleFiles = (files) => {
            const count = files.length;
            const validTypes = ['image/jpeg', 'image/png', 'image/jpg'];
            let hasInvalidFile = false;

            Array.from(files).forEach(file => {
                if (!validTypes.includes(file.type)) hasInvalidFile = true;
            });

            if (hasInvalidFile) {
                // Error State
                fileInfo.innerHTML = `
                    <span>Error: Only JPG/PNG allowed.</span>
                    <button type="button" class="clear-btn" onclick="clearFiles()">Clear</button>
                `;
                fileInfo.className = 'file-status active error';
                submitBtn.disabled = true;
                fileInput.value = ''; 
            } 
            else if (count > 0) {
                // Success State
                fileInfo.innerHTML = `
                    <span>${count} file${count > 1 ? 's' : ''} ready.</span>
                    <button type="button" class="clear-btn" onclick="clearFiles()">Clear</button>
                `;
                fileInfo.className = 'file-status active';
                submitBtn.disabled = false;
            } 
            else {
                // Empty State
                fileInfo.className = 'file-status';
                fileInfo.innerHTML = '';
            }
        };

        dropZone.addEventListener('drop', (e) => {
            const files = e.dataTransfer.files;
            fileInput.files = files;
            handleFiles(files);
        });

        fileInput.addEventListener('change', () => handleFiles(fileInput.files));
    </script>

</body>
</html>